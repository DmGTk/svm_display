import QtQuick 2.15
import QtQuick.Controls 2.15
import QtQuick.Layouts 1.15
import QtQuick.Window 2.15

Rectangle {
    id: workingMode
    width: Screen.width
    height: Screen.height
    color: "#000000"

    property string mode: "operator"
    property var appWindow: null
    property var stackView: null

    property real temperature: 22.5
    property real vibration: 0.3
    property real voltage: 221

    function statusColor() {
        return systemStatus() === "error" ? "#FF073A" :
               (systemStatus() === "warning" ? "#FFA500" : "#00C000")
    }

    function temperatureStatus(temp) {
        if (temp > 55) return "error"
        if (temp > 45) return "warning"
        return "normal"
    }

    function vibrationStatus(vib) {
        if (vib > 1.2) return "error"
        if (vib > 0.8) return "warning"
        return "normal"
    }

    function voltageStatus(volt) {
        if (volt < 200 || volt > 240) return "error"
        if (volt < 210 || volt > 230) return "warning"
        return "normal"
    }

    function systemStatus() {
        var statuses = [temperatureStatus(temperature), vibrationStatus(vibration), voltageStatus(voltage)]
        if (statuses.indexOf("error") !== -1) return "error"
        if (statuses.indexOf("warning") !== -1) return "warning"
        return "normal"
    }

    Timer {
        interval: 2000
        running: true
        repeat: true
        onTriggered: {
            temperature = Math.max(20, Math.min(70, temperature + (Math.random() - 0.5) * 2))
            vibration = Math.max(0, Math.min(2, vibration + (Math.random() - 0.5) * 0.2))
            voltage = Math.max(200, Math.min(240, voltage + (Math.random() - 0.5) * 5))
        }
    }

    ColumnLayout {
        anchors.fill: parent
        anchors.margins: 32
        spacing: 28

        RowLayout {
            Layout.fillWidth: true
            Layout.alignment: Qt.AlignHCenter
            spacing: 10
            Text {
                text: "SVM1"
                font.pixelSize: 22
                font.family: "monospace"
                color: "#00FFFF"
                font.bold: true
            }
            Item { Layout.fillWidth: true }
            Text {
                text: mode === "operator" ? "[OPERATOR MODE]" : "[ADMINISTRATOR MODE]"
                font.pixelSize: 14
                font.family: "monospace"
                color: "#FF00FF"
                font.bold: true
            }
        }

        RowLayout {
            Layout.fillWidth: true
            Layout.alignment: Qt.AlignHCenter
            spacing: 32

            Column {
                Layout.alignment: Qt.AlignHCenter | Qt.AlignVCenter
                spacing: 12
                width: statusCircle.width

                Rectangle {
                    id: statusCircle
                    width: 180
                    height: 180
                    radius: 90
                    color: statusColor()

                    SequentialAnimation on scale {
                        loops: Animation.Infinite
                        NumberAnimation { from: 1.0; to: 1.05; duration: 800; easing.type: Easing.InOutQuad }
                        NumberAnimation { from: 1.05; to: 1.0; duration: 800; easing.type: Easing.InOutQuad }
                    }
                    SequentialAnimation on opacity {
                        loops: Animation.Infinite
                        NumberAnimation { from: 0.85; to: 1; duration: 800 }
                        NumberAnimation { from: 1; to: 0.85; duration: 800 }
                    }
                }

                Text {
                    anchors.horizontalCenter: statusCircle.horizontalCenter
                    text: systemStatus() === "error" ? "ALERT" :
                          (systemStatus() === "warning" ? "WARNING" : "NORMAL")
                    font.pixelSize: 16
                    font.family: "monospace"
                    color: statusColor()
                    font.bold: true
                }
            }

            ColumnLayout {
                Layout.fillWidth: true
                Layout.preferredWidth: 540
                spacing: 14

                Rectangle {
                    id: tempCard
                    Layout.fillWidth: true
                    Layout.preferredHeight: 80
                    color: "#000000"
                    border.width: 3
                    property color barColor: "#00FF00"
                    border.color: barColor

                    RowLayout {
                        anchors.fill: parent
                        anchors.margins: 14
                        spacing: 10
                        Text {
                            text: "TEMPERATURE"
                            font.family: "monospace"
                            font.pixelSize: 16
                            color: tempCard.barColor
                            font.bold: true
                        }
                        Item { Layout.fillWidth: true }
                        Text {
                            text: temperature.toFixed(1) + " Â°C"
                            font.family: "monospace"
                            font.pixelSize: 18
                            color: tempCard.barColor
                            font.bold: true
                        }
                    }
                }

                Rectangle {
                    id: vibCard
                    Layout.fillWidth: true
                    Layout.preferredHeight: 80
                    color: "#000000"
                    border.width: 3
                    property color barColor: "#00FF00"
                    border.color: barColor

                    RowLayout {
                        anchors.fill: parent
                        anchors.margins: 14
                        spacing: 10
                        Text {
                            text: "VIBRATION"
                            font.family: "monospace"
                            font.pixelSize: 16
                            color: vibCard.barColor
                            font.bold: true
                        }
                        Item { Layout.fillWidth: true }
                        Text {
                            text: vibration.toFixed(2) + " mm/s"
                            font.family: "monospace"
                            font.pixelSize: 18
                            color: vibCard.barColor
                            font.bold: true
                        }
                    }
                }

                Rectangle {
                    id: voltCard
                    Layout.fillWidth: true
                    Layout.preferredHeight: 80
                    color: "#000000"
                    border.width: 3
                    property color barColor: "#00FF00"
                    border.color: barColor

                    RowLayout {
                        anchors.fill: parent
                        anchors.margins: 14
                        spacing: 10
                        Text {
                            text: "POWER VOLTAGE"
                            font.family: "monospace"
                            font.pixelSize: 16
                            color: voltCard.barColor
                            font.bold: true
                        }
                        Item { Layout.fillWidth: true }
                        Text {
                            text: voltage.toFixed(0) + " V"
                            font.family: "monospace"
                            font.pixelSize: 18
                            color: voltCard.barColor
                            font.bold: true
                        }
                    }
                }
            }
        }

        RowLayout {
            Layout.fillWidth: true
            spacing: 14

            Rectangle {
                Layout.fillWidth: true
                height: 70
                color: "#000000"
                border.width: 3
                border.color: "#FF007A"
                Text {
                    anchors.centerIn: parent
                    text: "STOP"
                    font.pixelSize: 16
                    font.family: "monospace"
                    color: "#FF007A"
                    font.bold: true
                }
                MouseArea {
                    anchors.fill: parent
                    onClicked: {
                        if (appWindow) {
                            appWindow.stopWorking()
                        }
                    }
                }
            }

            Rectangle {
                Layout.fillWidth: true
                height: 70
                color: "#000000"
                border.width: 3
                border.color: "#FF00FF"
                Text {
                    anchors.centerIn: parent
                    text: "CHANGE MODE"
                    font.pixelSize: 16
                    font.family: "monospace"
                    color: "#FF00FF"
                    font.bold: true
                }
                MouseArea {
                    anchors.fill: parent
                    onClicked: {
                        if (appWindow) {
                            appWindow.isRunning = false
                            appWindow.currentMode = ""
                            appWindow.showModeSelection()
                        }
                    }
                }
            }

            Rectangle {
                Layout.fillWidth: true
                height: 70
                color: "#000000"
                border.width: 3
                border.color: "#00FFFF"
                Text {
                    anchors.centerIn: parent
                    text: "VIEW LOG"
                    font.pixelSize: 16
                    font.family: "monospace"
                    color: "#00FFFF"
                    font.bold: true
                }
                MouseArea {
                    anchors.fill: parent
                    onClicked: {
                        // Hook up to log viewer dialog if needed
                    }
                }
            }
        }
    }
}

